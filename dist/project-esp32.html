<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ESP32 Weather Station — Project</title>
  <meta name="description" content="Mini stazione meteo con ESP32: modello 3D ruotabile, galleria foto, schema e codice Arduino.">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="css/styles.css" rel="stylesheet"/>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@google/model-viewer@3.4.0/dist/model-viewer.min.js"></script>

  <style>
    .section-narrow { max-width: 980px; margin: 0 auto; }

    pre.codebox {
      background:#0f172a; color:#e2e8f0; padding:1rem;
      border-radius:.5rem; overflow-x:auto; overflow-y:auto;
      font-size:.95rem; line-height:1.4; white-space:pre;
      max-height:520px;
    }
    @media (max-width: 768px){
      pre.codebox { font-size:.72rem; padding:.65rem; max-height:240px; }
    }

    model-viewer{
      width:100%; height:320px; background:#f8fafc; border-radius:.5rem; display:block;
      --poster-color: transparent;
    }
    @media (max-width: 768px){ model-viewer{ height:240px; } }

    img, canvas, video { max-width:100%; height:auto; display:block; border-radius:.5rem; cursor:pointer; }

    section { margin-bottom:2.25rem; }
    @media (max-width: 768px){ section{ margin-bottom:1.35rem; } }

    /* Galleria piccola */
    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
    }

    /* Lightbox */
    .lightbox {
      display: none;
      position: fixed;
      z-index: 1050;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.9);
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    .lightbox.active { display: flex; }
    .lightbox img {
      max-width: 90%;
      max-height: 80vh;
      object-fit: contain;
      border-radius: .5rem;
      box-shadow: 0 0 20px rgba(255,255,255,0.2);
    }
    .lightbox button {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.3);
      border: none;
      color: white;
      font-size: 2rem;
      padding: .5rem .9rem;
      border-radius: 50%;
      cursor: pointer;
      transition: background 0.2s;
    }
    .lightbox button:hover { background: rgba(255,255,255,0.6); }
    .lightbox .prev { left: 5%; }
    .lightbox .next { right: 5%; }
    .lightbox .close {
      top: 5%;
      right: 5%;
      transform: none;
      font-size: 1.8rem;
    }

  </style>
</head>

<body>
<nav class="navbar navbar-expand-lg bg-secondary text-uppercase">
  <div class="container">
    <a class="navbar-brand text-white" href="index.html#portfolio">← Back to Portfolio</a>
  </div>
</nav>

<header class="py-5 bg-primary text-white text-center">
  <div class="container">
    <h1 class="mb-2">ESP32 Weather Station</h1>
    <p class="lead mb-0">
      Piccola stazione meteo basata su ESP32, capace di misurare temperatura e umidità tramite sensore DHT22
      e mostrare i dati su un display OLED. Il tutto è racchiuso in un case progettato su SolidWorks e stampato
      in 3D, con prese d’aria per una lettura accurata.
    </p>
  </div>
</header>

<main class="container my-4">

  <!-- 3D MODEL -->
  <section class="section-narrow">
    <h2 class="h4 mb-3">3D Model (rotate me)</h2>
    <model-viewer
      src="assets/3d/esp32-case.glb"
      poster="assets/img/portfolio/esp32-thumb.jpeg"
      camera-controls
      auto-rotate
      reveal="auto"
      crossorigin="anonymous"
      interaction-policy="allow-when-focused"
      alt="3D model of the ESP32 weather station enclosure">
    </model-viewer>
  </section>

  <!-- GALLERY -->
  <section class="section-narrow">
    <h2 class="h4 mb-3">Photo Gallery</h2>
    <div class="gallery-grid">
      <img src="assets/img/portfolio/esp32-thumb.jpeg" alt="Project cover">
      <img src="assets/img/portfolio/esp32-front.jpeg" alt="Front view">
      <img src="assets/img/portfolio/esp32-back.jpeg" alt="Back view">
      <img src="assets/img/portfolio/esp32-wiring.jpeg" alt="Wiring photo">
    </div>
  </section>

  <!-- LIGHTBOX -->
  <div class="lightbox" id="lightbox">
    <button class="prev">&#10094;</button>
    <img src="" alt="Expanded photo" id="lightbox-img">
    <button class="next">&#10095;</button>
    <button class="close">&times;</button>
  </div>

  <!-- WIRING -->
  <section class="section-narrow">
    <h2 class="h4 mb-3">Wiring</h2>
    <img src="assets/img/portfolio/esp32-wiring-tinkercad.jpeg" alt="Tinkercad wiring screenshot" class="shadow-sm">
  </section>

  <!-- CODE -->
  <section class="section-narrow">
    <h2 class="h4 mb-3">Code</h2>
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h3 class="h6 m-0">Arduino Code</h3>
      <a class="btn btn-sm btn-outline-secondary" target="_blank" rel="noopener" href="assets/code/esp32-weather-station.ino">Apri file</a>
    </div>
    <pre class="codebox"><code id="code-esp32">// Caricamento...</code></pre>
  </section>

  <!-- DOWNLOAD STL -->
  <section class="section-narrow mb-0">
    <h2 class="h4 mb-3">Downloads</h2>
    <ul class="list-unstyled">
      <li><a href="assets/stl/case-sensore-umidita-temperatura.stl" download>Case sensore umidità e temperatura (.stl)</a></li>
      <li><a href="assets/stl/tappo-case-sensore-umidita-temperatura.stl" download>Tappo del case (.stl)</a></li>
    </ul>
  </section>

</main>

<footer class="text-center py-4 bg-light">
  <div class="container">
    <a href="index.html#portfolio" class="btn btn-primary">← Back to Portfolio</a>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js"></script>

<!-- Lightbox Script -->
<script>
  const lightbox = document.getElementById('lightbox');
  const lightboxImg = document.getElementById('lightbox-img');
  const gallery = document.querySelectorAll('.gallery-grid img');
  let current = 0;

  gallery.forEach((img, i) => {
    img.addEventListener('click', () => {
      current = i;
      openLightbox();
    });
  });

  function openLightbox(){
    lightbox.classList.add('active');
    lightboxImg.src = gallery[current].src;
  }

  document.querySelector('.lightbox .close').onclick = () => lightbox.classList.remove('active');
  document.querySelector('.lightbox .prev').onclick = () => change(-1);
  document.querySelector('.lightbox .next').onclick = () => change(1);

  function change(dir){
    current = (current + dir + gallery.length) % gallery.length;
    lightboxImg.src = gallery[current].src;
  }

  lightbox.addEventListener('click', e => {
    if(e.target === lightbox) lightbox.classList.remove('active');
  });
</script>

<!-- Caricamento codice Arduino -->
<script>
  (async () => {
    try {
      const resp = await fetch('assets/code/esp32-weather-station.ino', { cache: 'no-store' });
      if (!resp.ok) throw new Error('HTTP ' + resp.status);
      const text = await resp.text();
      document.getElementById('code-esp32').textContent = text;
    } catch (e) {
      document.getElementById('code-esp32').textContent =
        '// Impossibile caricare il file .ino.\n// Verifica percorso: dist/assets/code/esp32-weather-station.ino';
    }
  })();
</script>

</body>
</html>
