<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ESP32 Weather Station ‚Äî Project</title>
  <meta name="description" content="Mini stazione meteo con ESP32: modello 3D ruotabile, schema Tinkercad, codice Arduino e galleria foto.">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="css/styles.css" rel="stylesheet"/>

  <!-- Precarica il modello 3D -->
  <link rel="preload" href="assets/3d/esp32-case.glb" as="fetch" type="model/gltf-binary" crossorigin="anonymous">

  <!-- model-viewer stabile -->
  <script type="module" src="https://cdn.jsdelivr.net/npm/@google/model-viewer@3.4.0/dist/model-viewer.min.js"></script>

  <style>
    /* Layout due colonne (wire + code) */
    .two-col { display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
    @media (max-width: 992px){ .two-col { grid-template-columns:1fr; } }

    /* Code box */
    pre.codebox {
      background:#0f172a; color:#e2e8f0; padding:1rem;
      border-radius:.5rem; overflow-x:auto; overflow-y:auto;
      font-size:.95rem; line-height:1.4; white-space:pre;
      max-height:520px;
    }
    @media (max-width: 768px){
      pre.codebox { font-size:.78rem; padding:.75rem; max-height:320px; }
    }

    /* 3D viewer responsive */
    model-viewer{
      width:100%; height:380px; background:#f8fafc; border-radius:.5rem; display:block;
      --poster-color: transparent;
    }
    @media (max-width: 768px){ model-viewer{ height:240px; } }

    /* Immagini generiche safe */
    img, canvas, video { max-width:100%; height:auto; display:block; border-radius:.5rem; }

    /* Spaziatura sezioni */
    section { margin-bottom:2.25rem; }
    @media (max-width: 768px){ section{ margin-bottom:1.35rem; } }

    /* Carousel (galleria foto) */
    .carousel-item img { width:100%; height:auto; }
    .carousel-indicators [data-bs-target]{ width:10px; height:10px; border-radius:50%; }

    /* Pulsante zoom (icona lente) sull'immagine */
    .zoomable { position:relative; cursor:zoom-in; }
    .zoomable::after{
      content:"üîç"; position:absolute; right:.5rem; bottom:.5rem; font-size:1.1rem; opacity:.85;
      background:rgba(255,255,255,.8); padding:.15rem .35rem; border-radius:.35rem;
    }
  </style>
</head>

<body>
<nav class="navbar navbar-expand-lg bg-secondary text-uppercase">
  <div class="container">
    <a class="navbar-brand text-white" href="index.html#portfolio">‚Üê Back to Portfolio</a>
  </div>
</nav>

<header class="py-5 bg-primary text-white text-center">
  <div class="container">
    <h1 class="mb-2">ESP32 Weather Station</h1>
    <p class="lead mb-3">Modello 3D ruotabile, schema su Tinkercad, codice Arduino e galleria foto.</p>
    <a class="btn btn-light btn-sm" target="_blank" rel="noopener" href="https://github.com/diegobergia03-italy/esp32-weather-station">
      <i class="fab fa-github me-1"></i> View on GitHub
    </a>
  </div>
</header>

<main class="container my-4">

  <!-- 3D MODEL -->
  <section>
    <h2 class="h4 mb-3">3D Model (rotate me)</h2>
    <model-viewer
      src="assets/3d/esp32-case.glb"
      poster="assets/img/portfolio/esp32-thumb.jpeg"
      camera-controls
      auto-rotate
      reveal="interaction"
      crossorigin="anonymous"
      ar-modes="webxr scene-viewer quick-look"
      touch-action="pan-y"
      alt="3D model of the ESP32 weather station enclosure">
      <div class="text-center p-4">
        Your browser can‚Äôt display the 3D model.
        Download: <a href="assets/3d/esp32-case.glb" download>esp32-case.glb</a>
      </div>
    </model-viewer>
    <p class="text-muted small mt-2">Suggerimento: trascina per ruotare, rotella per zoom, doppio tap per mettere a fuoco.</p>
  </section>

  <!-- WIRING + CODE -->
  <section>
    <h2 class="h4 mb-3">Wiring & Code</h2>
    <div class="two-col">
      <!-- Screenshot Tinkercad con zoom -->
      <div>
        <a class="zoomable" href="#" data-bs-toggle="modal" data-bs-target="#imgModal" data-img="assets/img/portfolio/esp32-wiring-tinkercad.jpeg">
          <img src="assets/img/portfolio/esp32-wiring-tinkercad.jpeg" alt="Tinkercad wiring screenshot" class="shadow-sm">
        </a>
        <p class="text-muted small mt-2">Tocca l‚Äôimmagine per ingrandirla a tutto schermo.</p>
      </div>

      <!-- Codice Arduino da file -->
      <div>
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h3 class="h6 m-0">Arduino Code</h3>
          <a class="btn btn-sm btn-outline-secondary" target="_blank" rel="noopener" href="assets/code/esp32-weather-station.ino">Apri file</a>
        </div>
        <pre class="codebox"><code id="code-esp32">// Caricamento...</code></pre>
        <p class="text-muted small mt-2">Percorso: <code>dist/assets/code/esp32-weather-station.ino</code></p>
      </div>
    </div>
  </section>

  <!-- GALLERIA FOTO SCORRIBILE + zoom -->
  <section>
    <h2 class="h4 mb-3">Photo Gallery</h2>

    <div id="galleryPhotos" class="carousel slide" data-bs-ride="carousel" data-bs-touch="true">
      <div class="carousel-inner rounded">
        <div class="carousel-item active">
          <a class="zoomable" href="#" data-bs-toggle="modal" data-bs-target="#imgModal" data-img="assets/img/portfolio/esp32-thumb.jpeg">
            <img src="assets/img/portfolio/esp32-thumb.jpeg" alt="Project cover - ESP32 weather sensor">
          </a>
        </div>
        <div class="carousel-item">
          <a class="zoomable" href="#" data-bs-toggle="modal" data-bs-target="#imgModal" data-img="assets/img/portfolio/esp32-front.jpeg">
            <img src="assets/img/portfolio/esp32-front.jpeg" alt="Sensor front view">
          </a>
        </div>
        <div class="carousel-item">
          <a class="zoomable" href="#" data-bs-toggle="modal" data-bs-target="#imgModal" data-img="assets/img/portfolio/esp32-back.jpeg">
            <img src="assets/img/portfolio/esp32-back.jpeg" alt="Sensor back view">
          </a>
        </div>
        <div class="carousel-item">
          <a class="zoomable" href="#" data-bs-toggle="modal" data-bs-target="#imgModal" data-img="assets/img/portfolio/esp32-wiring.jpeg">
            <img src="assets/img/portfolio/esp32-wiring.jpeg" alt="Full wiring photo">
          </a>
        </div>
      </div>

      <!-- Frecce -->
      <button class="carousel-control-prev" type="button" data-bs-target="#galleryPhotos" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#galleryPhotos" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </button>

      <!-- Indicatori -->
      <div class="carousel-indicators mt-3">
        <button type="button" data-bs-target="#galleryPhotos" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
        <button type="button" data-bs-target="#galleryPhotos" data-bs-slide-to="1" aria-label="Slide 2"></button>
        <button type="button" data-bs-target="#galleryPhotos" data-bs-slide-to="2" aria-label="Slide 3"></button>
        <button type="button" data-bs-target="#galleryPhotos" data-bs-slide-to="3" aria-label="Slide 4"></button>
      </div>
    </div>
    <p class="text-muted small mt-2">Su telefono scorri con il dito; su PC usa frecce o pallini. Tocca una foto per vederla a tutto schermo.</p>
  </section>

  <!-- DOWNLOAD -->
  <section class="mb-0">
    <h2 class="h4 mb-3">Downloads</h2>
    <ul class="list-unstyled">
      <li><a href="assets/stl/case-sensore-umidita-temperatura.stl" download>Case sensore umidit√† e temperatura (.stl)</a></li>
      <li><a href="assets/stl/tappo-case-sensore-umidita-temperatura.stl" download>Tappo del case (.stl)</a></li>
      <li><a href="assets/3d/esp32-case.glb" download>3D model (.glb)</a></li>
    </ul>
  </section>

</main>

<footer class="text-center py-4 bg-light">
  <div class="container">
    <a href="index.html#portfolio" class="btn btn-primary">‚Üê Back to Portfolio</a>
  </div>
</footer>

<!-- MODAL per zoom immagini -->
<div class="modal fade" id="imgModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
    <div class="modal-content bg-dark">
      <button type="button" class="btn-close btn-close-white ms-auto mt-2 me-2" data-bs-dismiss="modal" aria-label="Close"></button>
      <div class="modal-body p-0">
        <img id="imgModalTarget" src="" alt="zoom" class="w-100" style="max-height: calc(100vh - 3rem); object-fit: contain;">
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js"></script>

<!-- Carica il codice Arduino dallo .ino -->
<script>
  (async () => {
    try {
      const resp = await fetch('assets/code/esp32-weather-station.ino', { cache: 'no-store' });
      if (!resp.ok) throw new Error('HTTP ' + resp.status);
      const text = await resp.text();
      document.getElementById('code-esp32').textContent = text;
    } catch (e) {
      document.getElementById('code-esp32').textContent =
        '// Impossibile caricare il file .ino.\n// Verifica percorso: dist/assets/code/esp32-weather-station.ino';
    }
  })();

  // Modal zoom: prende il data-img del link cliccato
  const imgModal = document.getElementById('imgModal');
  imgModal.addEventListener('show.bs.modal', (ev) => {
    const btn = ev.relatedTarget;
    const src = btn?.getAttribute('data-img');
    document.getElementById('imgModalTarget').src = src || '';
  });
</script>

</body>
</html>
