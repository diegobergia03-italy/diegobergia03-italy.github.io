<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Auto-Tracking Camera Turret — Project</title>
  <meta name="description" content="Motorized camera turret with automatic subject for tracking, gesture-based zoom control.">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="css/styles.css" rel="stylesheet"/>
  <script type="module" src="https://cdn.jsdelivr.net/npm/@google/model-viewer@3.4.0/dist/model-viewer.min.js"></script>

  <style>
    .section-narrow { max-width: 980px; margin: 0 auto; }
    pre.codebox{
      background:#0f172a;color:#e2e8f0;padding:1rem;border-radius:.5rem;overflow:auto;
      font-size:.95rem;line-height:1.4;max-height:520px;white-space:pre;
    }

    .model-frame{
      background: radial-gradient(1200px 400px at 50% -100px, #1f2937 0%, #0b1020 70%);
      border-radius:.75rem; padding:10px;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06);
    }

    model-viewer{
      width:100%; height:320px; border-radius:.5rem; display:block;
      background: #0b1020;
      outline: none;
    }

    img, video{
      max-width:100%; height:auto; display:block; border-radius:.5rem;
      cursor:pointer; object-fit:cover;
    }

    .gallery-grid{
      display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:1rem;
    }

    /* Wiring image full width */
    .wiring-img {
      width: 100%;
      height: auto;
      border-radius: .5rem;
      object-fit: contain;
    }

    /* Lightbox */
    .lightbox{
      display:none; position:fixed; z-index:1050; inset:0; background:rgba(0,0,0,.9);
      justify-content:center; align-items:center; flex-direction:column;
    }
    .lightbox.active{ display:flex; }
    .lightbox img, .lightbox video{
      max-width:90%; max-height:80vh; object-fit:contain;
      border-radius:.5rem;
    }
    .lightbox button{
      position:absolute; top:50%; transform:translateY(-50%);
      background:rgba(255,255,255,.3); border:none; color:#fff;
      font-size:2rem; padding:.5rem .9rem; border-radius:50%; cursor:pointer;
    }
    .lightbox .prev{ left:5%; }
    .lightbox .next{ right:5%; }
    .lightbox .close{
      top:5%; right:5%; transform:none; font-size:1.8rem;
    }

  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg bg-secondary text-uppercase">
  <div class="container">
    <a class="navbar-brand text-white" href="index.html#portfolio">← Back to Portfolio</a>
  </div>
</nav>

<header class="py-5 bg-primary text-white text-center">
  <div class="container">
    <h1 class="mb-2">Auto-Tracking Camera Turret</h1>
    <p class="lead mb-0">
      Torretta motorizzata con videocamera e tracking automatico del soggetto.
      Gesture della mano per zoom, cambio modalità e interazione immediata.
    </p>
  </div>
</header>

<main class="container my-4">

  <!-- 3D MODEL -->
  <section class="section-narrow">
    <h2 class="h4 mb-3">3D Model (rotate me)</h2>
    <div class="model-frame">
      <model-viewer
        src="assets/3d/turret.glb"
        camera-controls auto-rotate reveal="auto" crossorigin="anonymous"
        environment-image="neutral"
        shadow-intensity="1" shadow-softness="0.9"
        exposure="0.9"
        camera-orbit="0deg 70deg 110%"
        field-of-view="35deg"
        alt="3D model of the auto-tracking camera turret">
      </model-viewer>
    </div>
  </section>

  <!-- GALLERY -->
  <section class="section-narrow">
    <h2 class="h4 mb-3">Photo & Video Gallery</h2>

    <div class="gallery-grid">

      <!-- Video -->
      <video autoplay muted loop playsinline preload="auto">
        <source src="assets/video/turret-demo.mp4" type="video/mp4">
      </video>

      <!-- Foto 1 -->
      <img src="assets/img/portfolio/turret-1.jpeg" alt="Camera turret front view">

      <!-- Foto 2 -->
      <img src="assets/img/portfolio/turret-2.jpeg" alt="Camera turret side view">

    </div>
  </section>

  <!-- LIGHTBOX -->
  <div class="lightbox" id="lightbox">
    <button class="prev">&#10094;</button>
    <img src="" alt="Expanded media" id="lightbox-img">
    <video id="lightbox-video" controls playsinline muted loop></video>
    <button class="next">&#10095;</button>
    <button class="close">&times;</button>
  </div>

  <!-- WIRING (ONLY PHOTO) -->
  <section class="section-narrow">
    <h2 class="h4 mb-3">Wiring</h2>

    <img src="assets/img/portfolio/turret-wiring.jpeg"
         alt="Wiring diagram"
         class="wiring-img shadow-sm">
  </section>

  <!-- CODE (CLEAN TITLES) -->
<section class="section-narrow">
  <h2 class="h4 mb-3">Code</h2>

  <div class="d-flex justify-content-between align-items-center mb-2">
    <h3 class="h6 m-0">Python Code</h3>
    <a class="btn btn-sm btn-outline-secondary" target="_blank" rel="noopener"
       href="assets/code/auto-tracking-turret.py">Apri file</a>
  </div>

  <pre class="codebox"><code id="code-turret"># Loading...</code></pre>
</section>


<!-- DOWNLOAD SECTION -->
<section class="section-narrow mb-0">
  <h2 class="h4 mb-3">Downloads</h2>

  <p class="text-muted small mb-2">
    I due pezzi che compongono la torretta:
  </p>

  <ul class="list-unstyled">
    <li><a href="assets/stl/turret-base.STL" download>Turret Base (.stl)</a></li>
    <li><a href="assets/stl/turret-head.STL" download>Turret Head (.stl)</a></li>
  </ul>
</section>


</main>

<footer class="text-center py-4 bg-light">
  <div class="container">
    <a href="index.html#portfolio" class="btn btn-primary">← Back to Portfolio</a>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js"></script>

<!-- Lightbox Script -->
<script>
  const lightbox = document.getElementById('lightbox');
  const imgBox = document.getElementById('lightbox-img');
  const videoBox = document.getElementById('lightbox-video');
  const mediaItems = document.querySelectorAll('.gallery-grid img, .gallery-grid video');
  let current = 0;

  mediaItems.forEach((el, i) => {
    el.addEventListener('click', () => { current = i; openLightbox(); });
  });

  function openLightbox(){ lightbox.classList.add('active'); showCurrent(); }

  function showCurrent(){
    const el = mediaItems[current];
    if (el.tagName === 'IMG') {
      videoBox.pause(); videoBox.removeAttribute('src'); videoBox.load();
      videoBox.style.display = 'none'; imgBox.style.display = 'block'; imgBox.src = el.src;
    } else {
      imgBox.removeAttribute('src'); imgBox.style.display = 'none';
      videoBox.style.display = 'block';
      const src = el.querySelector('source') ? el.querySelector('source').src : el.src;
      videoBox.src = src; videoBox.muted = true; videoBox.loop = true;
      videoBox.play().catch(()=>{});
    }
  }

  document.querySelector('.lightbox .close').onclick = () => {
    lightbox.classList.remove('active');
    videoBox.pause();
  };
  document.querySelector('.lightbox .prev').onclick  = () => change(-1);
  document.querySelector('.lightbox .next').onclick  = () => change(1);

  function change(dir){
    current = (current + dir + mediaItems.length) % mediaItems.length;
    showCurrent();
  }

  lightbox.addEventListener('click', e => {
    if (e.target === lightbox) {
      lightbox.classList.remove('active');
      videoBox.pause();
    }
  });

  // Load code file
  (async () => {
    try {
      const resp = await fetch('assets/code/auto-tracking-turret.py', { cache: 'no-store' });
      if (!resp.ok) throw new Error('HTTP ' + resp.status);
      const text = await resp.text();
      document.getElementById('code-turret').textContent = text;
    } catch (e) {
      document.getElementById('code-turret').textContent =
        '# Unable to load code file.\n# Check path: dist/assets/code/auto-tracking-turret.py';
    }
  })();
</script>

</body>
</html>
